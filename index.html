<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <title>chef-monit by Glassdoor</title>
  </head>

  <body>

    <header>
      <div class="container">
        <h1>chef-monit</h1>
        <h2>Chef cookbook for monit package</h2>

        <section id="downloads">
          <a href="https://github.com/Glassdoor/chef-monit/zipball/master" class="btn">Download as .zip</a>
          <a href="https://github.com/Glassdoor/chef-monit/tarball/master" class="btn">Download as .tar.gz</a>
          <a href="https://github.com/Glassdoor/chef-monit" class="btn btn-github"><span class="icon"></span>View on GitHub</a>
        </section>
      </div>
    </header>

    <div class="container">
      <section id="main_content">
        <h1>
<a id="chef-monit" class="anchor" href="#chef-monit" aria-hidden="true"><span class="octicon octicon-link"></span></a>chef-monit</h1>

<h2>
<a id="description" class="anchor" href="#description" aria-hidden="true"><span class="octicon octicon-link"></span></a>Description</h2>

<p>Installs the <code>monit</code> package from (<a href="http://mmonit.com/monit/">http://mmonit.com/monit/</a>).</p>

<h2>
<a id="requirements" class="anchor" href="#requirements" aria-hidden="true"><span class="octicon octicon-link"></span></a>Requirements</h2>

<h3>
<a id="supported-platforms" class="anchor" href="#supported-platforms" aria-hidden="true"><span class="octicon octicon-link"></span></a>Supported Platforms</h3>

<p>The following platforms are supported by this cookbook, meaning that the recipes run on these platforms without error:</p>

<ul>
<li>Ubuntu</li>
<li>Debian</li>
<li>RedHat</li>
<li>CentOS</li>
<li>Scientific</li>
<li>Fedora</li>
<li>SUSE</li>
<li>Amazon</li>
</ul>

<h2>
<a id="recipes" class="anchor" href="#recipes" aria-hidden="true"><span class="octicon octicon-link"></span></a>Recipes</h2>

<ul>
<li>
<code>monit</code> - The default recipe. Sets up the service definition and default checks.</li>
</ul>

<h2>
<a id="resources" class="anchor" href="#resources" aria-hidden="true"><span class="octicon octicon-link"></span></a>Resources</h2>

<h3>
<a id="monit_monitrc" class="anchor" href="#monit_monitrc" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>monit_monitrc</code>
</h3>

<p>The following will create a monitrc configuration:</p>

<div class="highlight highlight-ruby"><pre>monit_monitrc <span class="pl-s"><span class="pl-pds">"</span>ssh<span class="pl-pds">"</span></span> <span class="pl-k">do</span>
  variables({ <span class="pl-c1">category:</span> <span class="pl-s"><span class="pl-pds">"</span>system<span class="pl-pds">"</span></span> })
<span class="pl-k">end</span></pre></div>

<p>The <code>name</code> parameter must match a file located in your templates directory. In the example above, this would be <code>ssh.monitrc.erb</code>.</p>

<p>The <code>variables</code> option within the block is optional, and can contain a list of key-value pairs to assign within your template.</p>

<h2>
<a id="usage" class="anchor" href="#usage" aria-hidden="true"><span class="octicon octicon-link"></span></a>Usage</h2>

<p>This cookbook installs the monit components if not present, and pulls updates if they are installed on the system.</p>

<h2>
<a id="attributes" class="anchor" href="#attributes" aria-hidden="true"><span class="octicon octicon-link"></span></a>Attributes</h2>

<div class="highlight highlight-ruby"><pre><span class="pl-c"># Delay the start of polling when the service is started</span>
default[<span class="pl-s"><span class="pl-pds">"</span>monit<span class="pl-pds">"</span></span>][<span class="pl-s"><span class="pl-pds">"</span>start_delay<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-c1">0</span>

<span class="pl-c"># How frequently the monit daemon polls for changes.</span>
default[<span class="pl-s"><span class="pl-pds">"</span>monit<span class="pl-pds">"</span></span>][<span class="pl-s"><span class="pl-pds">"</span>polling_frequency<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-c1">20</span>

<span class="pl-c"># Use syslog for logging instead of a logfile.</span>
default[<span class="pl-s"><span class="pl-pds">"</span>monit<span class="pl-pds">"</span></span>][<span class="pl-s"><span class="pl-pds">"</span>use_syslog<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-c1">true</span>

<span class="pl-c"># If not using syslog, the log file that monit will use.</span>
default[<span class="pl-s"><span class="pl-pds">"</span>monit<span class="pl-pds">"</span></span>][<span class="pl-s"><span class="pl-pds">"</span>logfile<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>/var/log/monit.log<span class="pl-pds">"</span></span>

<span class="pl-c"># Where Monit stores unique Monit instance id</span>
default[<span class="pl-s"><span class="pl-pds">"</span>monit<span class="pl-pds">"</span></span>][<span class="pl-s"><span class="pl-pds">"</span>idfile<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>/var/.monit.id<span class="pl-pds">"</span></span>

<span class="pl-c"># Where Monit stores Monit state file</span>
default[<span class="pl-s"><span class="pl-pds">"</span>monit<span class="pl-pds">"</span></span>][<span class="pl-s"><span class="pl-pds">"</span>statefile<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>/var/lib/monit/state<span class="pl-pds">"</span></span>

<span class="pl-c"># Enable emails for internal monit alerts</span>
default[<span class="pl-s"><span class="pl-pds">"</span>monit<span class="pl-pds">"</span></span>][<span class="pl-s"><span class="pl-pds">"</span>mail_alerts<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-c1">true</span>

<span class="pl-c"># Ignore alerts for specific events</span>
<span class="pl-c"># Possible events include: action, checksum, connection, content, data, exec, fsflags, gid, icmp, instance, invalid, nonexist, permission, pid, ppid, resource, size, status, timeout, timestamp, uid, uptime.</span>
default[<span class="pl-s"><span class="pl-pds">"</span>monit<span class="pl-pds">"</span></span>][<span class="pl-s"><span class="pl-pds">"</span>alert_ignore_events<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> []

<span class="pl-c"># Email address that will be notified of events.</span>
default[<span class="pl-s"><span class="pl-pds">"</span>monit<span class="pl-pds">"</span></span>][<span class="pl-s"><span class="pl-pds">"</span>alert_email<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>root@localhost<span class="pl-pds">"</span></span>

<span class="pl-c"># Enable the web interface and define credentials.</span>
default[<span class="pl-s"><span class="pl-pds">"</span>monit<span class="pl-pds">"</span></span>][<span class="pl-s"><span class="pl-pds">"</span>web_interface<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> {
  <span class="pl-c1">enable:</span>  <span class="pl-c1">true</span>,
  <span class="pl-c1">port:</span>    <span class="pl-c1">2812</span>,
  <span class="pl-c1">address:</span> <span class="pl-s"><span class="pl-pds">"</span>localhost<span class="pl-pds">"</span></span>,
  <span class="pl-c1">allow:</span>   [<span class="pl-s"><span class="pl-pds">"</span>localhost<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>admin:b1gbr0th3r<span class="pl-pds">"</span></span>]
}

<span class="pl-c"># Email settings that will be used for notification of events.</span>
default[<span class="pl-s"><span class="pl-pds">"</span>monit<span class="pl-pds">"</span></span>][<span class="pl-s"><span class="pl-pds">"</span>mail<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> {
  <span class="pl-c1">hostname:</span> <span class="pl-s"><span class="pl-pds">"</span>localhost<span class="pl-pds">"</span></span>,
  <span class="pl-c1">port:</span>     <span class="pl-c1">25</span>,
  <span class="pl-c1">username:</span> <span class="pl-c1">nil</span>,
  <span class="pl-c1">password:</span> <span class="pl-c1">nil</span>,
  <span class="pl-c1">encrypted_credentials:</span> <span class="pl-c1">nil</span>,
  <span class="pl-c1">encrypted_credentials_data_bag:</span> <span class="pl-s"><span class="pl-pds">"</span>credentials<span class="pl-pds">"</span></span>,
  <span class="pl-c1">from:</span>     <span class="pl-s"><span class="pl-pds">"</span>monit@$HOST<span class="pl-pds">"</span></span>,
  <span class="pl-c1">subject:</span>  <span class="pl-s"><span class="pl-pds">"</span>$SERVICE $EVENT at $DATE<span class="pl-pds">"</span></span>,
  <span class="pl-c1">message:</span>  <span class="pl-s"><span class="pl-pds">"</span>Monit $ACTION $SERVICE at $DATE on $HOST,<span class="pl-cce">\n\n</span>$DESCRIPTION<span class="pl-cce">\n\n</span>Dutifully,<span class="pl-cce">\n</span>Monit<span class="pl-pds">"</span></span>,
  <span class="pl-c1">security:</span> <span class="pl-c1">nil</span>,  <span class="pl-c"># 'SSLV2'|'SSLV3'|'TLSV1'</span>
  <span class="pl-c1">timeout:</span>  <span class="pl-c1">30</span>
}

<span class="pl-k">case</span> node[<span class="pl-s"><span class="pl-pds">"</span>platform_family<span class="pl-pds">"</span></span>]
<span class="pl-k">when</span> <span class="pl-s"><span class="pl-pds">"</span>rhel<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>fedora<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>suse<span class="pl-pds">"</span></span>
  default[<span class="pl-s"><span class="pl-pds">"</span>monit<span class="pl-pds">"</span></span>][<span class="pl-s"><span class="pl-pds">"</span>main_config_path<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>/etc/monit.conf<span class="pl-pds">"</span></span>
  default[<span class="pl-s"><span class="pl-pds">"</span>monit<span class="pl-pds">"</span></span>][<span class="pl-s"><span class="pl-pds">"</span>includes_dir<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>/etc/monit.d<span class="pl-pds">"</span></span>
<span class="pl-k">else</span>
  default[<span class="pl-s"><span class="pl-pds">"</span>monit<span class="pl-pds">"</span></span>][<span class="pl-s"><span class="pl-pds">"</span>main_config_path<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>/etc/monit/monitrc<span class="pl-pds">"</span></span>
  default[<span class="pl-s"><span class="pl-pds">"</span>monit<span class="pl-pds">"</span></span>][<span class="pl-s"><span class="pl-pds">"</span>includes_dir<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>/etc/monit/conf.d<span class="pl-pds">"</span></span>
<span class="pl-k">end</span>

<span class="pl-c"># The monit::default recipe will load these monit_monitrc resources automatically</span>
<span class="pl-c"># NOTE setting this attribute at the default level will append values to the array</span>
default[<span class="pl-s"><span class="pl-pds">"</span>monit<span class="pl-pds">"</span></span>][<span class="pl-s"><span class="pl-pds">"</span>default_monitrc_configs<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">%w[</span>load ssh<span class="pl-pds">]</span></span>

<span class="pl-c"># Whether the monit service should be reloaded when a configuration changes</span>
default[<span class="pl-s"><span class="pl-pds">"</span>monit<span class="pl-pds">"</span></span>][<span class="pl-s"><span class="pl-pds">"</span>reload_on_change<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-c1">true</span>

<span class="pl-c"># `MONIT_OPTS` for /etc/default/monit</span>
default[<span class="pl-s"><span class="pl-pds">"</span>monit<span class="pl-pds">"</span></span>][<span class="pl-s"><span class="pl-pds">"</span>init_opts<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>

<span class="pl-c"># specify a particular version of the monit package you want installed,</span>
<span class="pl-c"># otherwise it will install the default. this value is ignored when performing a</span>
<span class="pl-c"># source install.</span>
default[<span class="pl-s"><span class="pl-pds">"</span>monit<span class="pl-pds">"</span></span>][<span class="pl-s"><span class="pl-pds">"</span>version<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-c1">nil</span>

<span class="pl-c"># source install specifics</span>
default[<span class="pl-s"><span class="pl-pds">"</span>monit<span class="pl-pds">"</span></span>][<span class="pl-s"><span class="pl-pds">"</span>source_install<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-c1">false</span>

default[<span class="pl-s"><span class="pl-pds">"</span>monit<span class="pl-pds">"</span></span>][<span class="pl-s"><span class="pl-pds">"</span>source<span class="pl-pds">"</span></span>][<span class="pl-s"><span class="pl-pds">"</span>version<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>5.7<span class="pl-pds">"</span></span>
default[<span class="pl-s"><span class="pl-pds">"</span>monit<span class="pl-pds">"</span></span>][<span class="pl-s"><span class="pl-pds">"</span>source<span class="pl-pds">"</span></span>][<span class="pl-s"><span class="pl-pds">"</span>prefix<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>/usr/local<span class="pl-pds">"</span></span>
default[<span class="pl-s"><span class="pl-pds">"</span>monit<span class="pl-pds">"</span></span>][<span class="pl-s"><span class="pl-pds">"</span>source<span class="pl-pds">"</span></span>][<span class="pl-s"><span class="pl-pds">"</span>url<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>https://mmonit.com/monit/dist/monit-5.7.tar.gz<span class="pl-pds">"</span></span>
default[<span class="pl-s"><span class="pl-pds">"</span>monit<span class="pl-pds">"</span></span>][<span class="pl-s"><span class="pl-pds">"</span>source<span class="pl-pds">"</span></span>][<span class="pl-s"><span class="pl-pds">"</span>checksum<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>bb250ab011d805b5693972afdf95509e79bb3b390caa763275c9501f74b598a2<span class="pl-pds">"</span></span>
default[<span class="pl-s"><span class="pl-pds">"</span>monit<span class="pl-pds">"</span></span>][<span class="pl-s"><span class="pl-pds">"</span>source<span class="pl-pds">"</span></span>][<span class="pl-s"><span class="pl-pds">"</span>pam_support<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-c1">true</span>
default[<span class="pl-s"><span class="pl-pds">"</span>monit<span class="pl-pds">"</span></span>][<span class="pl-s"><span class="pl-pds">"</span>source<span class="pl-pds">"</span></span>][<span class="pl-s"><span class="pl-pds">"</span>ssl_support<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-c1">true</span>
default[<span class="pl-s"><span class="pl-pds">"</span>monit<span class="pl-pds">"</span></span>][<span class="pl-s"><span class="pl-pds">"</span>source<span class="pl-pds">"</span></span>][<span class="pl-s"><span class="pl-pds">"</span>large_file_support<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-c1">true</span>
default[<span class="pl-s"><span class="pl-pds">"</span>monit<span class="pl-pds">"</span></span>][<span class="pl-s"><span class="pl-pds">"</span>source<span class="pl-pds">"</span></span>][<span class="pl-s"><span class="pl-pds">"</span>compiler_optimized<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-c1">true</span></pre></div>

<h2>
<a id="contributors" class="anchor" href="#contributors" aria-hidden="true"><span class="octicon octicon-link"></span></a>Contributors</h2>

<p>Many thanks go to the following <a href="https://github.com/phlipper/chef-monit/graphs/contributors">contributors</a> who have helped to make this cookbook even better:</p>

<ul>
<li>
<strong><a href="https://github.com/werdan">@werdan</a></strong>

<ul>
<li>add support for redhat-flavored systems</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/auser">@auser</a></strong>

<ul>
<li>add missing metadata</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/arrowcircle">@arrowcircle</a></strong>

<ul>
<li>update syntax to be Ruby 1.8-compatible</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/dwradcliffe">@dwradcliffe</a></strong>

<ul>
<li>typo fix for README</li>
<li>fix logging logic</li>
<li>whyrun support for monitrc provider</li>
<li>support for reloading monit without restart</li>
<li>don't render 'use address' if no address is provided</li>
<li>fix attribute comments</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/tjwallace">@tjwallace</a></strong>

<ul>
<li>load default monitrc configs from an attribute</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/tomdz">@tomdz</a></strong>

<ul>
<li>Ruby 1.8.x compatibility fix</li>
<li>add support for templates in different cookbooks</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/alexism">@alexism</a></strong>

<ul>
<li>support other security protocols</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/fixlr">@fixlr</a></strong>

<ul>
<li>add <code>mail_alerts</code> attribute</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/darron">@darron</a></strong>

<ul>
<li>add descriptions to email notifications</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/claco">@claco</a></strong>

<ul>
<li>add startup delay option to monit daemon config</li>
<li>restart on default monitrc configs change</li>
<li>restart monit service if the monit config changes</li>
<li>fix platform family logic</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/maciejgalkiewicz">@maciejgalkiewicz</a></strong>

<ul>
<li>fix logging logic</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/pauloricardomg">@pauloricardomg</a></strong>

<ul>
<li>add <code>alert_ignore_events</code> attribute</li>
<li>add <code>reload_on_change</code> attribute</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/drywheat">@drywheat</a></strong>

<ul>
<li>support encrypted data bag for smtp credentials</li>
<li>add support for installation from source vs. package</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/esigler">@esigler</a></strong>

<ul>
<li>allow either style of monit startup flag to work</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/evan2645">@evan2645</a></strong>

<ul>
<li>fix bug in which monit is not started during bootstrap</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/mvdkleijn">@mvdkleijn</a></strong>

<ul>
<li>add settings for idfile and statefile</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/mbanton">@mbanton</a></strong>

<ul>
<li>fix <code>statefile</code> attribute in <code>monitrc</code> template</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/foxycoder">@foxycoder</a></strong>

<ul>
<li>add support for binary install</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/ijin">@ijin</a></strong>

<ul>
<li>add <code>using_hostname</code> attribute</li>
<li>better ssh support for Amazon Linux</li>
</ul>
</li>
</ul>

<h2>
<a id="contributing" class="anchor" href="#contributing" aria-hidden="true"><span class="octicon octicon-link"></span></a>Contributing</h2>

<ol>
<li>Fork it</li>
<li>Create your feature branch (<code>git checkout -b my-new-feature</code>)</li>
<li>Commit your changes (<code>git commit -am 'Added some feature'</code>)</li>
<li>Push to the branch (<code>git push origin my-new-feature</code>)</li>
<li>Create new Pull Request</li>
</ol>

<h2>
<a id="license" class="anchor" href="#license" aria-hidden="true"><span class="octicon octicon-link"></span></a>License</h2>

<p><strong>chef-monit</strong></p>

<ul>
<li>Freely distributable and licensed under the MIT license</li>
<li>Copyright (c) 2011-2014 Phil Cohen (<a href="mailto:github@phlippers.net">github@phlippers.net</a>)</li>
</ul>
      </section>
    </div>

              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-10172882-2");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>